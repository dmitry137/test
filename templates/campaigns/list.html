{% extends "layout.html" %}

{% block title %}–ö–∞–º–ø–∞–Ω–∏–∏ - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏—è–º–∏{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏—è–º–∏</h1>
  <a href="/campaigns/create" class="btn btn-primary create-campaign-btn">
      <span class="btn-icon">+</span>
      –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é
  </a>
</div>

<div class="campaigns-grid">
  {% for id, campaign in campaigns.items() %}
  <div class="campaign-card" data-id="{{ campaign.id }}">
      <div class="campaign-header">
          <h2 class="campaign-title">{{ campaign.name }}</h2>
          <div class="campaign-status status-{{ campaign.status }}">
              {% if campaign.status == "running" %}–ó–∞–ø—É—â–µ–Ω–∞{% else %}–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞{% endif %}
          </div>
      </div>

      <div class="campaign-info">
          <div class="info-item">
              <span class="info-label">ID:</span>
              <span class="info-value">{{ campaign.id }}</span>
          </div>
          <div class="info-item">
              <span class="info-label">–°–æ–∑–¥–∞–Ω–∞:</span>
              <span class="info-value">{{ campaign.created_at|replace("T", " ")|truncate(16, True, "") }}</span>
          </div>
      </div>

      <div class="campaign-actions">
          <button class="btn btn-toggle" data-action="toggle" data-status="{{ campaign.status }}">
              {% if campaign.status == "running" %}
              –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
              {% else %}
              –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
              {% endif %}
          </button>
          <a href="/campaigns/{{ campaign.id }}/edit" class="btn btn-secondary">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </a>
      </div>
  </div>
  {% else %}
  <div class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h2>–ü–æ–∫–∞ –Ω–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π</h2>
      <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
      <a href="/campaigns/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</a>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle campaign status
  document.querySelectorAll('.btn-toggle').forEach(button => {
      button.addEventListener('click', async function() {
          const campaignId = this.closest('.campaign-card').dataset.id;
          const response = await fetch(`/campaigns/${campaignId}/toggle`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              }
          });

          if (response.ok) {
              const data = await response.json();
              const card = this.closest('.campaign-card');
              const statusElement = card.querySelector('.campaign-status');

              // Update status display
              statusElement.className = `campaign-status status-${data.status}`;
              statusElement.textContent = data.status === 'running' ? '–ó–∞–ø—É—â–µ–Ω–∞' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';

              // Update button text
              this.textContent = data.status === 'running' ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é';
              this.dataset.status = data.status;

              // Add animation
              card.classList.add('status-changed');
              setTimeout(() => {
                  card.classList.remove('status-changed');
              }, 1000);
          }
      });
  });
});
</script>
{% endblock %}

